# TWSEPacketParser 專案架構設計說明

本文件整理並說明 TWSEPacketParser 專案中的各個 `.h` 標頭檔案設計目的、動機與合理性，涵蓋抽象層、解析器、封包格式、共用工具與控制流程。

---

## 🧩 base/ 抽象介面與工廠類別

### `TWSEPacketBase.h`

* **用途**：作為所有 Format 封包的共同基底，提供 `virtual bool verifyAll()` 等驗證接口。
* **設計動機**：封包解析流程中需進行基本驗證（ESC、XOR、Terminal），統一定義接口可強化多型性與一致性。
* ✅ 合理設計：支援後續擴展（如 Format2/3），每種格式僅需 override。

### `TWSEFormatParser.h`

* **用途**：純虛擬類別 `TWSEFormatParser`，定義 parser 共同接口（如 `parse()`、`getFormatName()`）。
* **設計動機**：可由工廠與控制器使用抽象型別處理所有格式。
* ✅ 合理設計：讓 parser 有統一行為，符合開放封閉原則（OCP）。

### `TWSEParsedResult.h`

* **用途**：解析後結果的抽象型別，可定義如 `print()`、`getStockCode()` 等接口。
* **設計動機**：不同格式解析完成後能以統一型別進行後續流程（儲存、展示、比對）。
* ✅ 合理設計：便於控制器與資料庫模組使用 `shared_ptr<TWSEParsedResult>`。

### `TWSEParserFactory.h`

* **用途**：根據 formatCode 建立對應的 parser。
* **設計動機**：封裝 `if` / `switch` 邏輯，集中格式判斷職責。
* ✅ 合理設計：未來新增 format 只需新增一個 case，不影響使用端。

---

## 🧰 common/ 共用工具（模板與編碼轉換）

### `FixedArray.h` / `FixedArray.tpp`

* **用途**：模板類別，定義固定長度陣列（如股票代號、價格欄位）。
* **設計動機**：使結構體定義簡潔且編譯期固定大小，避免動態記憶體管理與格式錯位。
* ✅ 合理設計：保證記憶體佈局，利於 BCD/ASCII 對應解析。

### `TBCD.h`

* **用途**：支援 BCD 格式轉十進位的模板工具。
* **設計動機**：將 byte\[] → 整數轉換封裝為模板，支援通用欄位解析。
* ✅ 合理設計：利於價格、時間等 BCD 欄位轉換。

### `AsciiUtils.h`

* **用途**：處理 ASCII 補空格、對齊等操作。
* **設計動機**：常見於股票名稱、代號等欄位的清理與標準化。
* ✅ 合理設計：工具層分離，減少主程式邏輯干擾。

### `EncodingUtils.h`

* **用途**：BIG5 → UTF-8、價格補位、代碼補齊等雜項編碼處理。
* ✅ 合理設計：集中轉換邏輯，有助跨平台、GUI 等使用情境。

---

## 📘 format1/ 專用封包與解析器

### `TWSEFormat1.h`

* **用途**：定義 Format1 封包結構（114 Bytes），封裝股票基本資料、權證資訊與驗證方法。
* ✅ 合理設計：封包結構與驗證邏輯集中於資料類別本身，利於直接解析與檢查。

### `TWSEFormat1Parser.h`

* **用途**：宣告 Format1 專用解析器。
* ✅ 合理設計：parser 負責封包解析與轉換，與資料結構分離，方便拆測與維護。

---

## 📗 format6/ 與 format1 相同設計邏輯

* 格式六封包設計與 Format1 一致：固定區段結構 + 動態價格揭示區段。
* ✅ 合理設計：格式結構明確，解析器與資料結構分離，動態欄位處理靈活。

---

## 📦 result/ 封裝解析結果（OOP 對外呈現）

### `TWSEParsedFormat1Result.h`, `TWSEParsedFormat6Result.h`

* **用途**：提供封包轉換後更易於使用的資料格式（如 string, double, GUI 顯示欄位）。
* **設計動機**：原始封包為 BCD 與定長欄位，不便於直接使用，需轉為高階結構。
* ✅ 合理設計：這是一個封裝轉換層，讓底層與應用邏輯解耦。

---

## 🎮 controller/ 控制流程類別

### `TWSEPacketParser.h`

* **用途**：主控制器，處理 rawData → 分段 → 呼叫對應解析器。
* ✅ 合理設計：封包分流、驗證與解析流程集中，使用 factory + interface 結構。

### `TWSEApp.h`

* **用途**：應用層入口，封裝檔案載入、解析呼叫、資料儲存與輸出流程。
* ✅ 合理設計：CLI / 測試 / TCP server 可共用核心邏輯。

---

> 本文件後續可加上類別圖或封包流程圖強化視覺說明。
